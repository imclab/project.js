(function(t){var j=function(a){this.options=a||{};this.sourcewidth=this.options.sourcewidth||100;this.sourceheight=this.options.sourceheight||100;this.targetwidth=this.options.targetwidth||100;this.targetheight=this.options.targetheight||100;this.corner=[{x:0,y:0},{x:this.sourcewidth,y:0},{x:this.sourcewidth,y:this.sourceheight},{x:0,y:this.sourceheight}];this.matrix=[[1,0,0],[0,1,0],[0,0,1]];this.invmatrix=[[1,0,0],[0,1,0],[0,0,1]];this.update()};j.prototype.update=function(){function a(a,b){return f[a][b]}
var g=this.sourcewidth/2,d=this.sourceheight/2,e=this.corner[0].x/g-1,c=this.corner[0].y/d-1,b=this.corner[1].x/g-1,h=this.corner[1].y/d-1,l=this.corner[3].x/g-1,j=this.corner[3].y/d-1,g=this.corner[2].x/g-1,m=this.corner[2].y/d-1,f=[[0,0,0],[0,0,0],[0,0,0]],k,n,q,r,p,d=b-g;k=l-g;n=e-b+g-l;q=h-m;r=j-m;p=c-h+m-j;0==n&&0==p?(f[0][0]=b-e,f[0][1]=g-b,f[0][2]=e,f[1][0]=h-c,f[1][1]=m-h,f[1][2]=c,f[2][0]=0,f[2][1]=0):(g=d*r-q*k,f[2][0]=0==g?1:(n*r-p*k)/g,f[2][1]=0==g?1:(d*p-q*n)/g,f[0][0]=b-e+f[2][0]*b,
f[0][1]=l-e+f[2][1]*l,f[0][2]=e,f[1][0]=h-c+f[2][0]*h,f[1][1]=j-c+f[2][1]*j,f[1][2]=c);f[2][2]=1;this.matrix=f;c=1/(+a(0,0)*(a(1,1)*a(2,2)-a(2,1)*a(1,2))-a(0,1)*(a(1,0)*a(2,2)-a(1,2)*a(2,0))+a(0,2)*(a(1,0)*a(2,1)-a(1,1)*a(2,0)));e=[[0,0,0],[0,0,0],[0,0,0]];b=(a(1,1)*a(2,2)-a(2,1)*a(1,2))*c;e[0][0]=b;b=-(a(0,1)*a(2,2)-a(0,2)*a(2,1))*c;e[0][1]=b;b=(a(0,1)*a(1,2)-a(0,2)*a(1,1))*c;e[0][2]=b;b=-(a(1,0)*a(2,2)-a(1,2)*a(2,0))*c;e[1][0]=b;b=(a(0,0)*a(2,2)-a(0,2)*a(2,0))*c;e[1][1]=b;b=-(a(0,0)*a(1,2)-a(1,
0)*a(0,2))*c;e[1][2]=b;b=(a(1,0)*a(2,1)-a(2,0)*a(1,1))*c;e[2][0]=b;b=-(a(0,0)*a(2,1)-a(2,0)*a(0,1))*c;e[2][1]=b;c*=a(0,0)*a(1,1)-a(1,0)*a(0,1);e[2][2]=c;this.invmatrix=e};j.prototype.project=function(a,g){var d=this.invmatrix,e=this.sourcewidth/2,c=this.sourceheight/2,e=(a-1*e)/e,c=(g-1*c)/c,b=d[2][0]*e+d[2][1]*c+d[2][2];return{x:this.targetwidth/1*(d[0][0]*e+d[0][1]*c+d[0][2])/b,y:this.targetheight/1*(d[1][0]*e+d[1][1]*c+d[1][2])/b}};j.prototype.reverse=function(a,g){var d=this.matrix,e=this.sourcewidth/
2,c=this.sourceheight/2,b=this.targetwidth/1,h=this.targetheight/1,b=(a-0*b)/b,h=(g-0*h)/h,j=d[2][0]*b+d[2][1]*h+d[2][2];return{x:e+e*(d[0][0]*b+d[0][1]*h+d[0][2])/j,y:c+c*(d[1][0]*b+d[1][1]*h+d[1][2])/j}};var s=function(a){a=a||{};this.projection=a.projection||null;this.source=a.source||null;this.target=a.target||null};s.prototype.draw=function(){var a=this.projection;this.target.clearRect(0,0,a.targetwidth,a.targetheight);for(var g=this.source.getImageData(0,0,a.sourcewidth,a.sourceheight),d=this.target.getImageData(0,
0,a.targetwidth,a.targetheight),e=0;e<a.targetheight;e+=1)for(var c=0;c<a.targetwidth;c+=1){var b=a.reverse(c,e),h=4*(e*a.targetwidth+c),b=4*(Math.round(b.y)*a.sourcewidth+Math.round(b.x));d.data[h+0]=g.data[b+0];d.data[h+1]=g.data[b+1];d.data[h+2]=g.data[b+2];d.data[h+3]=g.data[b+3]}this.target.putImageData(d,0,0)};var k={};k.Unwarp=j;k.CanvasUnwarp=s;t.Project=k})(this);
